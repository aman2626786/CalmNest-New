(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5583],{5017:function(e,t,r){Promise.resolve().then(r.bind(r,57372))},71774:function(e,t,r){"use strict";var a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,l=Object.prototype.hasOwnProperty,s=(e,t,r)=>new Promise((a,o)=>{var n=e=>{try{s(r.next(e))}catch(e){o(e)}},l=e=>{try{s(r.throw(e))}catch(e){o(e)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,l);s((r=r.apply(e,t)).next())}),i={};((e,t)=>{for(var r in t)a(e,r,{get:t[r],enumerable:!0})})(i,{SessionContextProvider:()=>f,useSession:()=>p,useSessionContext:()=>m,useSupabaseClient:()=>g,useUser:()=>v}),e.exports=((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of n(t))l.call(e,i)||i===r||a(e,i,{get:()=>t[i],enumerable:!(s=o(t,i))||s.enumerable});return e})(a({},"__esModule",{value:!0}),i);var u=r(2265),d=r(57437),c=(0,u.createContext)({isLoading:!0,session:null,error:null,supabaseClient:{}}),f=({supabaseClient:e,initialSession:t=null,children:r})=>{let[a,o]=(0,u.useState)(t),[n,l]=(0,u.useState)(!t),[i,f]=(0,u.useState)();(0,u.useEffect)(()=>{!a&&t&&o(t)},[a,t]),(0,u.useEffect)(()=>{let t=!0;return function(){s(this,null,function*(){let{data:{session:r},error:a}=yield e.auth.getSession();if(t){if(a){f(a),l(!1);return}o(r),l(!1)}})}(),()=>{t=!1}},[]),(0,u.useEffect)(()=>{let{data:{subscription:t}}=e.auth.onAuthStateChange((e,t)=>{t&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e||"USER_UPDATED"===e)&&o(t),"SIGNED_OUT"===e&&o(null)});return()=>{t.unsubscribe()}},[]);let m=(0,u.useMemo)(()=>n?{isLoading:!0,session:null,error:null,supabaseClient:e}:i?{isLoading:!1,session:null,error:i,supabaseClient:e}:{isLoading:!1,session:a,error:null,supabaseClient:e},[n,a,i]);return(0,d.jsx)(c.Provider,{value:m,children:r})},m=()=>{let e=(0,u.useContext)(c);if(void 0===e)throw Error("useSessionContext must be used within a SessionContextProvider.");return e};function g(){let e=(0,u.useContext)(c);if(void 0===e)throw Error("useSupabaseClient must be used within a SessionContextProvider.");return e.supabaseClient}var p=()=>{let e=(0,u.useContext)(c);if(void 0===e)throw Error("useSession must be used within a SessionContextProvider.");return e.session},v=()=>{var e,t;let r=(0,u.useContext)(c);if(void 0===r)throw Error("useUser must be used within a SessionContextProvider.");return null!=(t=null==(e=r.session)?void 0:e.user)?t:null}},99376:function(e,t,r){"use strict";var a=r(35475);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},57372:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var a=r(57437),o=r(2265),n=r(88933),l=r(99376),s=r(12381),i=r(40279),u=r(75060),d=r(79820),c=r(58086);function f(){let[e,t]=(0,o.useState)(""),[r,f]=(0,o.useState)(""),[m,g]=(0,o.useState)(""),[p,v]=(0,o.useState)(""),[h,x]=(0,o.useState)(!1),b=(0,l.useRouter)(),{updateProfile:y,refreshProfile:S}=(0,c.G)(),w=async t=>{t.preventDefault(),x(!0),v("");try{let{data:{user:t}}=await n.O.auth.getUser();if(!t){v("You must be logged in to set up a profile."),b.push("/login");return}localStorage.setItem("userEmail",t.email||""),localStorage.setItem("userId",t.id),localStorage.setItem("userName",e),await y({full_name:e,age:Number(r),gender:m}),v("Profile setup complete! Redirecting..."),await S(),setTimeout(()=>{b.push("/dashboard")},1e3)}catch(e){console.error("Unexpected error:",e),v("An unexpected error occurred. Please try again.")}finally{x(!1)}};return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-900 via-purple-900/10 to-gray-900 flex items-center justify-center",children:(0,a.jsxs)(d.Zb,{className:"w-full max-w-md bg-gray-800 border-gray-700 text-white",children:[(0,a.jsxs)(d.Ol,{className:"text-center",children:[(0,a.jsx)(d.ll,{className:"text-3xl font-bold",children:"Complete Your Profile"}),(0,a.jsx)(d.SZ,{children:"Please fill in your details to continue."})]}),(0,a.jsx)(d.aY,{children:(0,a.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{htmlFor:"fullName",children:"Full Name"}),(0,a.jsx)(i.I,{id:"fullName",type:"text",placeholder:"John Doe",value:e,onChange:e=>t(e.target.value),className:"bg-gray-700 border-gray-600 text-white",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{htmlFor:"age",children:"Age"}),(0,a.jsx)(i.I,{id:"age",type:"number",placeholder:"25",value:r,onChange:e=>f(""===e.target.value?"":parseInt(e.target.value,10)),className:"bg-gray-700 border-gray-600 text-white",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{htmlFor:"gender",children:"Gender"}),(0,a.jsxs)("select",{id:"gender",value:m,onChange:e=>g(e.target.value),className:"w-full p-2 bg-gray-700 border-gray-600 text-white rounded-md",required:!0,children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"Select your gender"}),(0,a.jsx)("option",{value:"male",children:"Male"}),(0,a.jsx)("option",{value:"female",children:"Female"}),(0,a.jsx)("option",{value:"transgender",children:"Transgender"}),(0,a.jsx)("option",{value:"other",children:"Other"}),(0,a.jsx)("option",{value:"prefer-not-to-say",children:"Prefer not to say"})]})]}),p&&(0,a.jsx)("p",{className:"text-center text-sm text-gray-300",children:p}),(0,a.jsx)("div",{className:"flex flex-col space-y-4",children:(0,a.jsx)(s.z,{type:"submit",className:"w-full bg-purple-600 hover:bg-purple-700",disabled:h,children:h?"Saving...":"Save and Continue"})})]})})]})})}},12381:function(e,t,r){"use strict";r.d(t,{d:function(){return i},z:function(){return u}});var a=r(57437),o=r(2265),n=r(37053),l=r(90535),s=r(93448);let i=(0,l.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=o.forwardRef((e,t)=>{let{className:r,variant:o,size:l,asChild:u=!1,...d}=e,c=u?n.g7:"button";return(0,a.jsx)(c,{className:(0,s.cn)(i({variant:o,size:l,className:r})),ref:t,...d})});u.displayName="Button"},79820:function(e,t,r){"use strict";r.d(t,{Ol:function(){return s},SZ:function(){return u},Zb:function(){return l},aY:function(){return d},eW:function(){return c},ll:function(){return i}});var a=r(57437),o=r(2265),n=r(93448);let l=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...o})});l.displayName="Card";let s=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...o})});s.displayName="CardHeader";let i=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",r),...o})});i.displayName="CardTitle";let u=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...o})});u.displayName="CardDescription";let d=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...o})});d.displayName="CardContent";let c=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...o})});c.displayName="CardFooter"},40279:function(e,t,r){"use strict";r.d(t,{I:function(){return l}});var a=r(57437),o=r(2265),n=r(93448);let l=o.forwardRef((e,t)=>{let{className:r,type:o,...l}=e;return(0,a.jsx)("input",{type:o,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});l.displayName="Input"},75060:function(e,t,r){"use strict";r.d(t,{_:function(){return u}});var a=r(57437),o=r(2265),n=r(6394),l=r(90535),s=r(93448);let i=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),u=o.forwardRef((e,t)=>{let{className:r,...o}=e;return(0,a.jsx)(n.f,{ref:t,className:(0,s.cn)(i(),r),...o})});u.displayName=n.f.displayName},58086:function(e,t,r){"use strict";r.d(t,{G:function(){return i},X:function(){return s}});var a=r(57437),o=r(2265),n=r(71774);let l=(0,o.createContext)(void 0);function s(e){var t;let{children:r}=e,[s,i]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0),c=(0,n.useSession)();(0,n.useSupabaseClient)();let f=async()=>{var e,t,r;if(!(null==c?void 0:null===(e=c.user)||void 0===e?void 0:e.id)){i(null),d(!1);return}try{d(!0);let e=await fetch("http://127.0.0.1:5001/api/profile/".concat(c.user.id));if(e.ok){let t=await e.json(),r={id:c.user.id,email:c.user.email||"",full_name:t.full_name,age:t.age,gender:t.gender,updated_at:t.updated_at};i(r),localStorage.setItem("userProfile",JSON.stringify(r)),localStorage.setItem("userEmail",c.user.email||""),localStorage.setItem("userId",c.user.id),localStorage.setItem("userName",t.full_name||""),console.log("Profile fetched from Flask backend:",r)}else if(404===e.status){let e={id:c.user.id,email:c.user.email||"",full_name:(null===(t=c.user.user_metadata)||void 0===t?void 0:t.full_name)||""};i(e),localStorage.setItem("userProfile",JSON.stringify(e)),localStorage.setItem("userEmail",c.user.email||""),localStorage.setItem("userId",c.user.id),localStorage.setItem("userName",e.full_name||""),console.log("No profile found, created basic profile:",e)}else throw Error("Failed to fetch profile: ".concat(e.status))}catch(e){if(console.error("Error fetching profile:",e),null==c?void 0:c.user){let e={id:c.user.id,email:c.user.email||"",full_name:(null===(r=c.user.user_metadata)||void 0===r?void 0:r.full_name)||""};i(e),localStorage.setItem("userProfile",JSON.stringify(e)),localStorage.setItem("userEmail",c.user.email||""),localStorage.setItem("userId",c.user.id),localStorage.setItem("userName",e.full_name||""),console.log("Using fallback profile:",e)}}finally{d(!1)}},m=async e=>{var t;if(!(null==c?void 0:null===(t=c.user)||void 0===t?void 0:t.id)){console.error("No session or user ID available for profile update");return}console.log("UserProfileContext: Updating profile with data:",e),console.log("Current profile:",s);try{let t={id:c.user.id,email:c.user.email||"",full_name:e.full_name,age:e.age,gender:e.gender,updated_at:new Date().toISOString()};try{let r=await fetch("http://127.0.0.1:5001/api/profile/".concat(c.user.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.user.email,full_name:e.full_name,age:e.age,gender:e.gender})});if(r.ok){let e=await r.json();console.log("Profile updated successfully in Flask backend:",e);let a=e.profile;t.updated_at=a.updated_at}else console.log("Flask backend update failed, continuing with localStorage only")}catch(e){console.log("Flask backend operations failed, using localStorage only:",e)}console.log("Updating local profile state:",t),i(t),localStorage.setItem("userProfile",JSON.stringify(t)),localStorage.setItem("userName",t.full_name||""),localStorage.setItem("userEmail",t.email||""),localStorage.setItem("userId",t.id),console.log("Profile updated successfully in localStorage")}catch(e){throw console.error("Critical error updating profile:",e),e}},g=async()=>{await f()};return(0,o.useEffect)(()=>{var e;(null==c?void 0:null===(e=c.user)||void 0===e?void 0:e.id)?(console.log("UserProfileContext: Session detected, fetching profile for:",c.user.id),f()):(console.log("UserProfileContext: No session, clearing profile data"),i(null),d(!1),localStorage.removeItem("userProfile"),localStorage.removeItem("userName"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"))},[null==c?void 0:null===(t=c.user)||void 0===t?void 0:t.id]),(0,a.jsx)(l.Provider,{value:{profile:s,loading:u,updateProfile:m,refreshProfile:g},children:r})}function i(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("useUserProfile must be used within a UserProfileProvider");return e}},88933:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let a=(0,r(71545).eI)("https://dummy-project.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1bW15LXByb2plY3QiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTY0NjA2NzI2MCwiZXhwIjoxOTYxNjQzMjYwfQ.dummy-key-for-development")},93448:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var a=r(61994),o=r(53335);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.m6)((0,a.W)(t))}},6394:function(e,t,r){"use strict";r.d(t,{f:function(){return s}});var a=r(2265),o=r(66840),n=r(57437),l=a.forwardRef((e,t)=>(0,n.jsx)(o.WV.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var s=l},66840:function(e,t,r){"use strict";r.d(t,{WV:function(){return s},jH:function(){return i}});var a=r(2265),o=r(54887),n=r(37053),l=r(57437),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,n.Z8)(`Primitive.${t}`),o=a.forwardRef((e,a)=>{let{asChild:o,...n}=e,s=o?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(s,{...n,ref:a})});return o.displayName=`Primitive.${t}`,{...e,[t]:o}},{});function i(e,t){e&&o.flushSync(()=>e.dispatchEvent(t))}}},function(e){e.O(0,[5569,244,1545,2971,2117,1744],function(){return e(e.s=5017)}),_N_E=e.O()}]);